<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>上海网球场地图</title>

    <link rel="stylesheet" href="https://cdn.staticfile.net/leaflet/1.9.4/leaflet.min.css" type="text/css"/>
    <link rel="stylesheet" href="https://opengeo.tech/maps/leaflet-search/src/leaflet-search.css" type="text/css"/>
    <link rel="stylesheet" href="js/easy-button.css">
    <link rel="stylesheet" href="js/leaflet-tag-filter-button.css"/>
    <link rel="stylesheet" href="js/L.Control.Locate.min.css"/>
    <link rel="stylesheet" href="https://cdn.staticfile.net/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="js/leaflet.fullscreen.css"/>
    <link rel="stylesheet" href="js/Tab.css">
    <link rel="stylesheet" href="https://cdn.staticfile.net/element-plus/2.5.3/index.min.css"/>
    <link rel="stylesheet" href="selectVenueSession.css"/>
    <link rel="stylesheet" href="js/leaflet-sidebar.css"/>

    <script src="js/jquery.slim.min.js"></script>
    <script src="js/vue.global.prod.min.js"></script>
    <script src="js/leaflet.min.js" type="text/javascript"></script>
    <script src="js/leaflet.polylineDecorator.js"></script>
    <script src="js/leaflet.textpath.min.js"></script>
    <script src="js/leaflet-search.src.js"></script>
    <script src="js/leaflet.markercluster.js"></script>
    <script src="js/easy-button.js"></script>
    <script src="js/leaflet-tag-filter-button.js"></script>
    <script src="js/leaflet-sidebar.js"></script>
    <script src="js/L.Control.Locate.min.js" charset="utf-8"></script>
    <script src='js/Leaflet.fullscreen.min.js'></script>
    <script src="https://cdn.staticfile.net/element-plus/2.10.3/index.full.min.js"></script>
    <script src="https://cdn.staticfile.net/element-plus/2.10.3/locale/zh-cn.min.js"></script>
    <script src="js/mitt.umd.js"></script>


    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?84e5e9f0f48263cffdb4aa9e19d8cbef";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .my-marker {
            background-color: #964DFF;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
        }

        .my-marker-blue {
            background-color: #6495ED;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
        }

        .my-marker-green {
            background-color: #2E8B57;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
        }

        .my-marker-red {
            background-color: #CC3333;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
        }

        .my-marker-cadetblue {
            background-color: #339999;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
        }

        .my-marker-powderblue {
            background-color: #00CED1;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
        }

        .my-marker-crimson {
            background-color: #DC143C;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
        }

        .line-arrow {
            font: bold 5px sans-serif;
        }

        .text-label {
            background-color: transparent;
            border: none;
            box-shadow: none;
            font-weight: bold;
            color: black;
            text-shadow: -1px -1px 0 #fff,
            1px -1px 0 #fff,
            -1px 1px 0 #fff,
            1px 1px 0 #fff;
            opacity: 0.5;
            font-size: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .container #routes {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000;
        }

        .post-category {
            margin: 0 0.1em;
            padding: 0.3em 1em;
            color: #fff;
            background: #999;
            font-size: 80%;
        }

        .post-category-green {
            background: #5aba59;
        }

        .post-category-blue {
            background: #4d85d1;
        }

        .post-category-red {
            background: #df2d4f;
        }

        p {
            display: inline-block;
            /* height: 10px; */
        }

        .easy-button-button {
            display: block !important;
        }

        .tag-filter-tags-container {
            position: fixed;
            z-index: 1000;
            top: 20px;
            left: 25px;
        }

        .leaflet-popup-content {
            min-width: 300px;
            min-height: 500px;
        }

        /* el-divider 修改分割线垂直间距 */
        .el-divider--horizontal {
            margin: 8px 0;
            /* background: 0 0; */
            /* border-top: 1px dashed #e8eaec; */
        }

        /* 加载前 */
        .el-image__placeholder {
            background: url('assets/loading.gif') no-repeat 50% 50% !important;
            background-size: 50% !important;
        }
    </style>

    <style>
    body {
      text-align: center;
    }
    /* button {
      width: 100px;
      height: 30px;
    } */
    #popup {
      display: none;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      position: fixed;
      z-index: 999999;
      background-color: rgba(50, 50, 50, 0.9);
    }
    #form {
      position: absolute;
      background-color: #f5f5f5;
      border: 1px solid #212121;
      border-radius: 2px;
      padding: 20px;
      width: 300px;
      left: 50%;
      top: 10%;
      margin-left: -150px;
    }
    input {
      width: 250px;
      margin-bottom: 20px;
    }
    #close {
      position: absolute;
      font-weight: bold;
      margin-left: 139px;
      margin-top: -19px;
      width: 30px;
      height: 27px;
    }
    p1 {
      float: left;
      margin-left: 30px;
    }
    .cont {
      /* background-color: #e3f2fd; */
      border-radius: 2px;
      padding: 2px 5px;
      width: 350px;
      margin: 10px auto 10px auto;
      text-align: left;
      overflow: auto;
      z-index: 999999;
    }
    #add {
      margin: 10px;
    }
    </style>
    <style>
    .infinite-list {
        /* height: 1000px; */
        padding: 0;
        margin: 0;
        list-style: none;
    }
    .infinite-list-item {
        display: flex;
        align-items: center;
        justify-content: center;
        /* height: 50px; */
        background: var(--el-color-primary-light-9);
        margin: 10px;
        color: var(--el-color-primary);
    }
    .infinite-list .infinite-list-item + .list-item {
        margin-top: 10px;
    }
    </style>
</head>

<body>
<div id="app" class="container">
    <el-container v-loading.fullscreen.lock="loading" :element-loading-text="loadingContent"></el-container>

    <div id="popup">
        <el-dialog
            v-model="searchDialogVisible" :before-close="handleClose" width="300">
            实时搜索可订场地
            <el-form :model="searchForm" :rules="searchFormRules" ref="searchForm" @submit.prevent label-width="auto" style="max-width: 200px">
                <el-form-item label="订场日期" prop="date" required>
                    <el-date-picker v-model="searchForm.date" type="date" :teleported="false"/>
                </el-form-item>
                <el-form-item label="订场时长" prop="continues_hour">
                    <el-input-number v-model="searchForm.continuesHour" placeholder="小时" :min="1" :max="10" />
                </el-form-item>
                <el-form-item label="最早开始" required>
                    <el-time-select
                    v-model="searchForm.startTime"
                    :max-time="searchForm.endTime"
                    :teleported="false"
                    start="06:00"
                    step="01:00"
                    end="24:00"
                    />
                </el-form-item>
                <el-form-item label="最晚结束" required>
                    <el-time-select
                    v-model="searchForm.endTime"
                    :min-time="searchForm.startTime"
                    :teleported="false"
                    start="06:00"
                    step="01:00"
                    end="24:00"
                    />
                </el-form-item>
                <el-form-item label="场馆类型" prop="stadium_types">
                    <el-select v-model="searchForm.stadiumTypes" multiple collapse-tags placeholder="请选择" :teleported="false">
                        <el-option v-for="(item, index) in stadiumTypes"
                            :key="index"
                            :label="item.label"
                            :value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="场地类型" prop="court_types">
                    <el-select v-model="searchForm.courtTypes" multiple collapse-tags placeholder="请选择" :teleported="false">
                        <el-option v-for="(item, index) in courtTypes"
                            :key="index"
                            :label="item.label"
                            :value="item.value">
                        </el-option>
                    </el-select>
                </el-form-item>
                <!-- <el-form-item label="搜索位置" prop="address">
                    <el-input v-model="searchForm.address" placeholder="尽量精确xx市xx区xx地点" :autosize="{ minRows: 1, maxRows: 3 }" />
                </el-form-item> -->
                <!-- <el-form-item label="球场名称" prop="name">
                    <el-input v-model="searchForm.name" />
                </el-form-item> -->
                <el-form-item>
                    <el-button type="primary" @click="submitSearchForm('searchForm')" id="search">提交</el-button>
                    <el-button @click="cancelSubmit('searchForm')">取消</el-button>
                </el-form-item>
            </el-form>
        </el-dialog>
    </div>

    <div id="map" class="sidebar-map"></div>
</div>

<script>
    const { createApp, ref, toRaw, reactive, defineCustomElement } = Vue
    const { FormRules } = ElementPlus
    const emitter = window.mitt()

    const reserveUrlMap = new Map();
    reserveUrlMap.set("韵动吧", "https://wxaurl.cn/hTEDKSSRuCv");
    reserveUrlMap.set("久事体育", "https://wxaurl.cn/dOfuzHF1HLu");
    reserveUrlMap.set("上海市体育场馆设施管理中心", "https://wxaurl.cn/BoimWOnwCMv");
    reserveUrlMap.set("健身地图", "https://wxaurl.cn/vsRlh4YeATp");
    reserveUrlMap.set("趣运动", "https://wxaurl.cn/rOq8uf7RTKo");
    reserveUrlMap.set("我要运动", "https://wxaurl.cn/KdSVnShwvun");
    reserveUrlMap.set("静安体育综合服务平台", "https://wxaurl.cn/l0VqsjuUFGp");
    reserveUrlMap.set("乐动力体育中心", "https://wxaurl.cn/U8TSfTkhaip");
    reserveUrlMap.set("九回共享", "https://wxaurl.cn/e5qCYXA9WOe");
    reserveUrlMap.set("勾勾运动", "https://wxaurl.cn/J204ILVGeWu");
    reserveUrlMap.set("DONGDONG", "https://wxaurl.cn/CKNX2vhbwAv");
    reserveUrlMap.set("泉衍体育", "https://wxaurl.cn/yqCrxx624Sv");
    reserveUrlMap.set("至臻网球", "https://wxaurl.cn/9UpiHeEIz5o");
    reserveUrlMap.set("满贯体育", "");
    reserveUrlMap.set("核新力网球运动中心", "https://wxaurl.cn/fkNc0Z9UoWc");
    reserveUrlMap.set("节奏网球俱乐部", "https://wxaurl.cn/UN1hzD1rbkc");
    reserveUrlMap.set("洛克公园小程序", "https://wxaurl.cn/VidXHdvkAEu");
    reserveUrlMap.set("体而加体育", "https://wxaurl.cn/zXDnafFnkUi");
    reserveUrlMap.set("巷澜体育智慧场所", "https://wxaurl.cn/3YaAMrGfCSp");
    reserveUrlMap.set("华东师范大学体育场馆管理系统", "");
    reserveUrlMap.set("源深体育", "");
    reserveUrlMap.set("绮梦网球", "https://wxaurl.cn/bqqKw4ZOECg");
    reserveUrlMap.set("Master123场馆预定", "https://wxaurl.cn/nCG9ZWOKAfm");
    reserveUrlMap.set("至诚网球", "https://wxaurl.cn/ofJ8XgQ2fvb");
    reserveUrlMap.set("瑛赛网球", "https://wxaurl.cn/Tx3QdfpiQYi");
    reserveUrlMap.set("运动码", "https://ur.alipay.com/_4oCOk3ljXQcF9tiVpAYaoO");
    reserveUrlMap.set("场馆预约预订", "https://wxaurl.cn/TKJtXrOUT1o");
    reserveUrlMap.set("全毅体育", "https://wxaurl.cn/G3jg3BTFg3l");
    reserveUrlMap.set("TennisBox网球训练房", "https://wxaurl.cn/kfpKaGThg6l");
    reserveUrlMap.set("青立方运动中心", "https://wxaurl.cn/wClR6NdL49g");
    reserveUrlMap.set("金高体育", "");
    reserveUrlMap.set("极网体育", "https://wxaurl.cn/dJ1ftZBJ96n");
    reserveUrlMap.set("跃测网球", "https://wxaurl.cn/DhjD3Ve8hgr");
    reserveUrlMap.set("辣飞运动", "https://wxaurl.cn/FyynLARslNd");
    reserveUrlMap.set("同心云", "");
    reserveUrlMap.set("交我办", "");

    app = createApp({
        data() {
            return {
                mapInfo: {
                    "id": 630008,
                    "title": "上海网球场大全",
                    "cover": "",
                    "introduction": "",
                    "poiCount": 1,
                    "contents": [{
                        "contentId": "RIqwwJWSIL",
                        "type": "mapPoi",
                        "mapPoiId": 6473364,
                        "mapRouteId": null,
                        "text": null,
                        "image": null,
                        "images": null,
                        "sort": 65536
                    }],
                    "mapPois": [],
                    "mapRoutes": [],
                    "mapGroups": [],
                    "mapAreas": []
                },
                dialogVisible: false,
                map: null,
                markers: [],
                buttonText: 'Zoom In',
                animalFilter: '',
                loading: true,
                loadingContent: "地图加载中，请稍后",
                searchControl: null,
                image: null,
                commentDialogVisible: false,
                searchDialogVisible: false,
                commentForm: {
                    stadiumId: 0,
                    name: '',
                    comment: '',
                    inputTags: [],
                    rate: null,
                },
                searchForm: {
                    date: '',
                    address: '',
                    name: '',
                    stadiumTypes: [],
                    courtTypes: [],
                    continuesHour: 0,
                    startTime: '06:00',
                    endTime: '23:00',
                },
                searchFormRules: {
                    date: [
                        { required: true, type: 'date', message: '请输入订场日期', trigger: 'change' },
                    ],
                },
                stadiumTypes: [
                    {
                        value: 1,
                        label: '室内',
                    },
                    {
                        value: 2,
                        label: '室外',
                    },
                    {
                        value: 3,
                        label: '半室内',
                    }
                ],
                courtTypes: [
                    {
                        value: 1,
                        label: '硬地',
                    },
                    {
                        value: 2,
                        label: '红土',
                    },
                    {
                        value: 3,
                        label: '草地',
                    },
                    {
                        value: 4,
                        label: '人造草地',
                    }
                ],
            };
        },
        mounted() {
            if ("json" in this.getQueryParams()) {
                jsonStr = getQueryParams()['json']
                jsonObj = eval('(' + jsonStr + ')')
                pois = jsonObj['mapPois']
                console.log(pois)
                for (var i = 0; i < pois.length; i++) {
                    var obj = pois[i];
                    this.mapInfo.mapPois.push(obj)
                }
                console.log(this.mapInfo.mapPois)
            }

            // 创建地图
            var map = L.map('map', {
                tapHold: false,
            }).setMinZoom(3)
                .setMaxZoom(19)
                .setView([31.23, 121.47], 14);

            // 重新Tooltip和L.Popup 的扩展方法（这个需要在你定义地图后重写，位置自己看着放）
            if (map) {
                // 添加 Tooltip 的扩展方法
                // L.Tooltip.include({
                //   _animateZoom(e: any) {
                //     console.log("Tooltip", this, this._map);
                //     if (this._map) {
                //       console.log("添加 Tooltip 的扩展方法 :>> ", this._map);
                //       const pos = this._map._latLngToNewLayerPoint(
                //         this._latlng,
                //         e.zoom,
                //         e.center
                //       );
                //       this._setPosition(pos);
                //     } else {
                //       return;
                //     }
                //   },
                // });
                L.Tooltip.prototype._animateZoom = function (e) {
                if (!this._map) {
                    return;
                }
                let pos = this._map._latLngToNewLayerPoint(
                    this._latlng,
                    e.zoom,
                    e.center
                );
                this._setPosition(pos);
                };

                L.Tooltip.prototype._updatePosition = function () {
                if (!this._map) {
                    return;
                }
                let pos = this._map.latLngToLayerPoint(this._latlng);
                this._setPosition(pos);
                };

                // 添加 Popup 的扩展方法
                L.Popup.include({
                _animateZoom(e) {
                    console.log("Popup", this._map);
                    if (this._map) {
                    const pos = this._map._latLngToNewLayerPoint(
                        this._latlng,
                        e.zoom,
                        e.center
                    );
                    const anchor = this._getAnchor();
                    L.DomUtil.setPosition(this._container, pos.add(anchor));
                    } else {
                    return;
                    }
                },
                });
                // 添加 Marker 的扩展方法
                // L.Marker.include({
                //   _animateZoom(opt: any) {
                //     console.log("Marker", this._map);
                //     if (this._map) {
                //       const pos = this._map
                //         ._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center)
                //         .round();
                //       this._setPos(pos);
                //     }
                //   },
                // });
            }

            this.map = map;

            map.attributionControl.setPrefix('');

            // L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            //     attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            // }).addTo(map);
            L.tileLayer('https://wprd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&x={x}&y={y}&z={z}', {
                attribution: '觉得好用就快分享给球友搭子们吧~<br>呼声高的话会继续开发小程序版本<br>疑问联系微信：shawyerpeng <a href="https://www.xiaohongshu.com/user/profile/56192ffc8a75e127d1fb2163" target="_blank">关注小红书</a>'
            }).addTo(map);

            // 移除默认右上角的缩放按钮
            map.zoomControl.remove();

            var lastZoom;
            zoomThreshold = 14;
            map.on('zoomend', function() {
                var zoom = map.getZoom();
                if (zoom < zoomThreshold && (!lastZoom || lastZoom >= zoomThreshold)) {
                    map.eachLayer(function(l) {
                    if (l.getTooltip) {
                        var toolTip = l.getTooltip();
                        if (toolTip) {
                            map.closeTooltip(toolTip);
                        }
                    }
                    });
                } else if (zoom >= zoomThreshold && (!lastZoom || lastZoom < zoomThreshold)) {
                    map.eachLayer(function(l) {
                    if (l.getTooltip) {
                        var toolTip = l.getTooltip();
                        if (toolTip) {
                            map.addLayer(toolTip);
                        }
                    }
                    });
                }
                lastZoom = zoom;
            })

            // 添加缩放控件到地图的右下角
            L.control.zoom({position: 'topright'}).addTo(map);

            // 显示地图比例尺到左下角，不显示英尺单位
            L.control.scale({position: 'bottomleft', imperial: false}).addTo(map);

            // 过滤器
            var tennisFilterButton1 = L.control.tagFilterButton({
                data: ['室内', '室外', '半室内'],
                // icon: '<i class="fa-solid fa-warehouse"></i>',
                icon: '<img src="arena.png">',
                clearText: "重置",
                filterOnEveryClick: true
            }).addTo(map);

            var tennisFilterButton4 = L.control.tagFilterButton({
                data: ['私有经营', '公共体育场馆', '小区', '学校', '酒店', '公园', '单位'],
                // icon: '<i class="fa-solid fa-table-tennis-paddle-ball"></i>',
                icon: '<img src="building.png">',
                clearText: "重置",
                filterOnEveryClick: true,
            }).addTo(map);

            var tennisFilterButton3 = L.control.tagFilterButton({
                data: ['硬地', '红土', '草地', '人造草地'],
                icon: '<img src="grass-court.png">',
                clearText: "重置",
                filterOnEveryClick: true,
            }).addTo(map);

            var tennisFilterButton2 = L.control.tagFilterButton({
                data: ['网球', '匹克球', '板式网球', '学练馆', '网球墙'],
                // icon: '<i class="fa-solid fa-table-tennis-paddle-ball"></i>',
                icon: '<img src="pickleball.png">',
                clearText: "重置",
                filterOnEveryClick: true,
            }).addTo(map);

            var facilityFilterButton = L.control.tagFilterButton({
                data: ['空调', '淋浴', '发球机', '多球租赁'],
                // icon: '<i class="fa-solid fa-person-booth"></i>',
                icon: '<img src="shower.png">',
                clearText: "重置",
                filterOnEveryClick: true,
            }).addTo(map);

            tennisFilterButton1.addToReleated(tennisFilterButton2);
            tennisFilterButton1.addToReleated(tennisFilterButton3);
            tennisFilterButton1.addToReleated(tennisFilterButton4);
            tennisFilterButton1.addToReleated(facilityFilterButton);

            // 定位插件
            L.control.locate({
                position: "topright",
                drawCircle: true,
                initialZoomLevel: 15,
                locateOptions: {
                    enableHighAccuracy: true
                }
            }).addTo(map);

            // 添加场馆实时搜索插件
            L.easyButton('fa-globe', this.onlineSearchBtnClick, 'search', {
                position: 'topright'
            }).addTo(map);

            // 全屏插件
            // map.addControl(new L.Control.Fullscreen({
            //   position:"topright",
            //   title: {
            //       'false': '点击全屏',
            //       'true': '退出全屏'
            //   }
            // }));

            // 侧边栏插件
            // var sidebar = L.control.sidebar('sidebar', {position: 'right'}).addTo(map);

            // 获取地图数据
            this.fetchPois(map)

            emitter.on('openCommentModal', this.addComment); // 监听事件
        },
        methods: {
            fetchPois(map, markerIcon) {
                const postData = {
                    "date_start": "2025-01-01",
                    "date_end": "2025-01-01",
                    "search_type": 3
                };

                fetch('https://shawyerpeng.cn:8888/labor/api/sports8/list', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Origin': 'github.com',
                    },
                    body: JSON.stringify(postData)  // 将JavaScript对象转换为JSON字符串发送
                }).then(response => {
                    if (!response.ok) {
                        this.loading = false;
                        throw new Error('网络请求失败，状态码：' + response.status);
                    }
                    return response.json();
                }).then(data => {
                    // console.log('POST请求成功，返回的数据：', data);
                    var idx = 0
                    for (var i = 0; i < data.data.length; i++) {
                        tmp = data.data[i]
                        if (tmp.LngLat == '0,0') {
                            continue
                        }
                        this.mapInfo.mapPois[idx++] = {
                            poi: {
                                id: tmp.StadiumId,
                                title: tmp.StadiumName,
                                Status: tmp.Status,
                                lng: parseFloat(tmp.LngLat.split(',')[0]),
                                lat: parseFloat(tmp.LngLat.split(',')[1]),
                                Address: tmp.Address,
                                ImgUrl: tmp.ImgUrl,
                                ImgUrls: tmp.ImgUrls,
                                StadiumType: tmp.StadiumType,
                                CourtType: tmp.CourtType,
                                SportsType: tmp.SportsType,
                                StadiumBizType: tmp.StadiumBizType,
                                Level: tmp.Level,
                                StadiumTel: tmp.StadiumTel,
                                ReservationPlatform: tmp.ReservationPlatform,
                                CountyName: tmp.CountyName,
                                Detail: tmp.Detail,
                                FacilityInfos: tmp.FacilityInfos,
                                MinPrice: tmp.MinPrice,
                                BookableMaxDate: tmp.BookableMaxDate,
                                ShowHour: tmp.ShowHour,
                                ShowHourDesc: tmp.ShowHourDesc,
                                CourtsNum: tmp.CourtsNum,
                            }
                        }
                    }
                    this.showMap(map, true);
                    this.loading = false;
                }).catch(error => {
                    console.error('POST请求出错：', error);
                    var idx = 0
                    data = JSON.parse(str)
                    for (var i = 0; i < data.data.length; i++) {
                        tmp = data.data[i]
                        if (tmp.LngLat == '0,0') {
                            continue
                        }
                        this.mapInfo.mapPois[idx++] = {
                            poi: {
                                id: tmp.StadiumId,
                                title: tmp.StadiumName,
                                Status: tmp.Status,
                                lng: parseFloat(tmp.LngLat.split(',')[0]),
                                lat: parseFloat(tmp.LngLat.split(',')[1]),
                                Address: tmp.Address,
                                ImgUrl: tmp.ImgUrl,
                                ImgUrls: tmp.ImgUrls,
                                StadiumType: tmp.StadiumType,
                                CourtType: tmp.CourtType,
                                SportsType: tmp.SportsType,
                                StadiumBizType: tmp.StadiumBizType,
                                Level: tmp.Level,
                                StadiumTel: tmp.StadiumTel,
                                ReservationPlatform: tmp.ReservationPlatform,
                                CountyName: tmp.CountyName,
                                Detail: tmp.Detail,
                                FacilityInfos: tmp.FacilityInfos,
                                MinPrice: tmp.MinPrice,
                                BookableMaxDate: tmp.BookableMaxDate,
                                ShowHour: tmp.ShowHour,
                                ShowHourDesc: tmp.ShowHourDesc,
                                CourtsNum: tmp.CourtsNum,
                            }
                        }
                    }
                    this.showMap(map, true);
                    this.loading = false;
                });
            },

            showMap(map, firstInit) {
                mapInfo = this.mapInfo;
                var markerIcon = L.icon({
                    iconUrl: "icon/marker.png",
                    iconSize: [24, 24],
                    iconAnchor: [12, 22],
                });

                // 只有第一次初始化的时候需要设置view大小
                // if (firstInit) {
                //     if (mapInfo.mapPois.length > 1) {
                //         bounds = this.getMapInfoBounds();
                //         if (bounds.length > 0) {
                //             map.fitBounds(bounds, {padding: [50, 50]});
                //         }
                //     } else if (mapInfo.mapPois.length == 1) {
                //         map.setView([mapInfo.mapPois[0].poi.lat, mapInfo.mapPois[0].poi.lng], 13);
                //     }
                // }

                markers = this.showAllPoiMarker(map, markerIcon);

                // 展示所有路线
                this.showAllRoute(map);

                // 展示所有路线
                this.showAllArea(map);

                // 先清空
                if (this.searchControl) {
                    map.removeControl(this.searchControl);
                }
                // 再重新添加
                var searchControl = new L.Control.Search({
                    position: 'topright',
                    layer: markers,
                    initial: false,
                    zoom: 14,
                    marker: false,
                    moveToLocation: function (latlng, title, map) {
                        // var zoom = map.getBoundsZoom(latlng.layer.getBounds());
                        map.setView(latlng, 14);
                    }
                });
                // https://github.com/stefanocudini/leaflet-search
                // https://github.com/Leaflet/Leaflet.markercluster
                searchControl.on('search:locationfound', function (e) {
                    // markers.zoomToShowLayer(e.layer, function() {
                    if (e.layer._popup) e.layer.openPopup();
                    // });
                });

                // searchControl.addTo(map);
                map.addControl(searchControl);
                this.searchControl = searchControl;
            },

            getMapInfoBounds() {
                mapInfo = this.mapInfo;
                // 循环 mapInfo mapPois, 获取所有经纬度
                var bounds = [];
                // var farawayNames=["","辉华网球俱乐部","上海建桥学院",""];
                var farawayDistricts = ["金山区", "奉贤区", "松江区", "闵行区", "青浦区", "宝山区", "杨浦区", "崇明区", "嘉定区", "浦东新区"];
                for (var i = 0; i < mapInfo.mapPois.length; i++) {
                    if (mapInfo.mapPois[i].poi.title.indexOf("乐动力·篮网球热力场") != -1 || mapInfo.mapPois[i].poi.CountyName == "" || farawayDistricts.includes(mapInfo.mapPois[i].poi.CountyName)) {
                        continue
                    }
                    ;
                    bounds.push([mapInfo.mapPois[i].poi.lat, mapInfo.mapPois[i].poi.lng]);
                }

                for (var i = 0; i < mapInfo.mapRoutes.length; i++) {
                    var route = mapInfo.mapRoutes[i];
                    if (route.paths.length == 0) {
                        continue;
                    }
                    for (var j = 0; j < route.paths.length; j++) {
                        var path = route.paths[j];
                        for (var k = 0; k < path.coordinates.length; k++) {
                            bounds.push([path.coordinates[k][1], path.coordinates[k][0]]);
                        }
                    }
                }

                return bounds;
            },

            showAllPoiMarker(map, markerIcon) {
                mapInfo = this.mapInfo;
                var markers = L.layerGroup();

                for (var i = 0; i < mapInfo.mapPois.length; i++) {
                    let poi = mapInfo.mapPois[i].poi;
                    var markerId = poi.id;

                    // var img = item.personImage ? item.personImage.replace("http:", "https:") + '?width=80px' : 'nouser.jpg';
                    // var title = '<div> <p style="font-weight:bold;width:300px;">' + poi.title + ''

                    tags = [poi.StadiumType]
                    if (poi.StadiumType == '室内和室外') {
                        tags[0] = '室内'
                        tags[1] = '室外'
                    }

                    tags.push(poi.StadiumBizType)
                    tags.push(poi.CourtType)

                    const sportsType = poi.SportsType.split('+')
                    if (sportsType.includes('网球')) {
                        tags.push('网球')
                    }
                    if (sportsType.includes('匹克球')) {
                        tags.push('匹克球')
                    }
                    if (sportsType.includes('板式网球')) {
                        tags.push('板式网球')
                    }
                    if (sportsType.includes('学练馆')) {
                        tags.push('学练馆')
                        tags.push('发球机')
                    }
                    if (sportsType.includes('网球墙')) {
                        tags.push('网球墙')
                    }

                    const facilityInfos = poi.FacilityInfos.split(',')
                    if (facilityInfos.includes('空调')) {
                        tags.push('空调')
                    }
                    if (facilityInfos.includes('洗浴')) {
                        tags.push('淋浴')
                    }
                    if (facilityInfos.includes('发球机')) {
                        tags.push('发球机')
                    }
                    if (facilityInfos.includes('多球租赁')) {
                        tags.push('多球租赁')
                    }

                    var marker = L.marker([poi.lat, poi.lng], {icon: markerIcon, title: poi.title, tags: tags});
                    if (poi.SportsType == "学练馆") {
                        var markerIcon2 = L.icon({
                            iconUrl: "icon/tennis-machine.png",
                            iconSize: [24, 24],
                            iconAnchor: [12, 22],
                        });
                        marker = L.marker([poi.lat, poi.lng], {icon: markerIcon2, title: poi.title, tags: tags});
                    } else {
                        if (poi.Status == 2) {
                            var markerIcon2 = L.icon({
                                iconUrl: "icon/marker2.png",
                                iconSize: [24, 24],
                                iconAnchor: [12, 22],
                            });
                            marker = L.marker([poi.lat, poi.lng], {icon: markerIcon2, title: poi.title, tags: tags});
                        } else if (poi.Level == 1) {
                            var markerIcon2 = L.icon({
                                iconUrl: "icon/crown.png",
                                iconSize: [24, 24],
                                iconAnchor: [12, 22],
                            });
                            marker = L.marker([poi.lat, poi.lng], {icon: markerIcon2, title: poi.title, tags: tags});
                        } else if (poi.Level == 2) {
                            var markerIcon2 = L.icon({
                                iconUrl: "icon/diamond.png",
                                iconSize: [24, 24],
                                iconAnchor: [12, 22],
                            });
                            marker = L.marker([poi.lat, poi.lng], {icon: markerIcon2, title: poi.title, tags: tags});
                        }
                    }

                    // 小区的z-index优先级放最低
                    if (poi.StadiumBizType == "小区") {
                        marker.setZIndexOffset(-1000);
                    }

                    marker.stadiumId = markerId;
                    marker.BookableMaxDate = poi.BookableMaxDate;
                    marker.ReservationPlatform = poi.ReservationPlatform;
                    marker.poi = poi;

                    // 通过vue的模板字符串创建并渲染到#my_popup节点上
                    let vm;
                    marker.on('popupopen', e => {
                        const m = e.popup._source, poi = m.poi;

                        // 仅韵动吧上的场馆显示查看可订状态按钮
                        isShowBtn = m.ReservationPlatform.includes("韵动吧");

                        var title = '<b id="title">' + poi.title + '</b>';
                        title += `
                        <el-button text size="small" style="padding: 0px 2px;" @click="copy">
                            <img src="assets/copy.svg" width="10" height="10" alt="Copy!">
                        </el-button>
                        `
                        if (poi.Status == 2) {
                            title += '<p class="post-category post-category-red">' + '已停业' + '</p>';
                        }
                        if (poi.StadiumType != "" || poi.CourtType != "") {
                            title += '  <p class="post-category post-category-blue">' + poi.StadiumType + ' ' + poi.CourtType + ' ' + (poi.CourtsNum != '0' ? poi.CourtsNum + '片' : "") + '</p>';
                        }
                        if (poi.SportsType != "网球") {
                            title += '  <p class="post-category post-category-blue">' + poi.SportsType + '</p>';
                        }
                        // title += '<el-rate class="ml-1" />';
                        title += '<el-image v-if="url != \'\'" :src="url" :preview-src-list="urlList" :initial-index="0" :preview-teleported=true :show-progress=true :hide-on-click-modal=true style="max-width:300px; display:flex; justify-content:center; align-items:center" :crossOrigin="null" >';
                        title += `
                        <template #placeholder>
                            <img src="assets/loading.gif" style="width: auto; height: 40px; border:none;"><br>
                        </template>
                        `
                        title += '</el-image>'
                        if (poi.hasOwnProperty("Address")) {
                            title += '<div><el-text class="mx-1" type="primary">' + poi.CountyName + '</el-text>' + ' ' + poi.Address + '</div>';
                        }
                        const ua = navigator.userAgent;
                        if (/iPhone|iPad|iPod|iOS/.test(ua)) {
                            title += '<div><a href="baidumap://map/marker?location=' + poi.lat + ',' + poi.lng + '&title=' + poi.title + '&content=' + poi.CountyName + poi.Address + '&coord_type=gcj02' + '" target="_blank">跳转百度地图</a> ';
                            title += '<a href="iosamap://viewMap?sourceApplication=大野後生仔&poiname=' + poi.title + '&lat=' + poi.lat + '&lon=' + poi.lng + '&dev=0' + '" target="_blank">跳转高德地图</a></div>';
                        } else if (/Android|android/.test(ua)) {
                            title += '<div><a href="baidumap://map/marker?location=' + poi.lat + ',' + poi.lng + '&title=' + poi.title + '&content=' + poi.CountyName + poi.Address + '&coord_type=gcj02' + '" target="_blank">跳转百度地图</a> ';
                            title += '<a href="androidamap://viewMap?sourceApplication=大野後生仔&poiname=' + poi.title + '&lat=' + poi.lat + '&lon=' + poi.lng + '&dev=0' + '" target="_blank">跳转高德地图</a></div>';
                        }

                        title += '<div>';
                        if (poi.StadiumTel != "") {
                            title += '<p class="post-category post-category-red">电话</p> ' + poi.StadiumTel + ' '
                        }
                        let isShowReservationBtn = false
                        let reservationUrl = ""
                        if (poi.ReservationPlatform != "") {
                            title += '<p class="post-category post-category-red">预订方式</p> ';
                            let vals = poi.ReservationPlatform.split(",");
                            for (let i = 0; i < vals.length; i++) {
                                title += ('<el-tag size="small">' + vals[i] + '</el-tag>');
                                if (isShowReservationBtn === false && reserveUrlMap.has(vals[i])) {
                                    if (reserveUrlMap.get(vals[i]) !== "") {
                                        reservationUrl = reserveUrlMap.get(vals[i])
                                        isShowReservationBtn = true
                                    }
                                }
                            }
                            title += ' ';
                        }
                        if (poi.MinPrice > 0) {
                            title += '<p class="post-category post-category-red">最低价格</p> ' + poi.MinPrice + '元' + ' '
                        }
                        if (poi.BookableMaxDate != "") {
                            title += '<p class="post-category post-category-red">最远可订</p> ' + poi.BookableMaxDate + '(' + this.getDayOfWeek(poi.BookableMaxDate) + ')' + ' '
                        }
                        if (poi.ShowHourDesc != "") {
                            title += '<p class="post-category post-category-red">抢场时间</p> ' + poi.ShowHourDesc + ' '
                        }
                        title += '</div>';
                        // <p><strong>设施信息：</strong> {{FacilityInfos}}</p>
                        if (poi.Detail != "") {
                            title += '<div><p class="post-category post-category-green">详情</p>' + poi.Detail
                            title += '</div>';
                        }

                        title += `
                          <el-divider v-if="` + isShowBtn + `"/>
                          <el-button type="primary" size="small" @click="change" v-if="` + isShowBtn + `">查看可订场地</el-button>
                          <el-button type="primary" size="small" v-if="` + isShowReservationBtn + `">
                            <a href="` + reservationUrl + `" target="_blank" style="color:#fff; text-decoration: none">打开订场小程序</a>
                          </el-button>
                          <div style="position: relative;overflow: hidden;">
                            <el-dialog
                              v-model="dialogVisible"
                              fullscreen
                              width="30%">
                              <iframe src="./reservation.html?stadium_id=` + m.stadiumId + "&max_date=" + m.BookableMaxDate + `" name="iframepage" :height="iFrameHeight" :width="iFrameWidth" style="transform:scale(0.5);transform-origin:0 0;display:block;border:0px"></iframe>
                            </el-dialog>
                          </div>
                        `;

                        const data = {
                            myUrl: poi.ImgUrl,
                            myUrlList: poi.ImgUrls,
                        };

                        vm = createApp({
                            template: title,
                            props: {
                                myUrl: String,
                                myUrlList: Array,
                            },
                            data() {
                                return {
                                    dialogVisible: false,
                                    url: "",
                                    urlList: [],
                                }
                            },
                            mounted() {
                                this.iFrameHeight = 1000;
                                this.iFrameWidth = 700;
                            },
                            setup(props) {
                                return {
                                    url: props.myUrl,
                                    urlList: props.myUrlList,
                                }
                            },
                            methods: {
                                change: function () {
                                    this.dialogVisible = true;
                                },
                                copy: function () {
                                    const copyText = document.querySelector('#title');
                                    navigator.clipboard.writeText(copyText.textContent);
                                },
                                addComment() {
                                    emitter.emit('openCommentModal', {res: "我是儿子的消息"}); // 触发事件总线事件
                                },
                            }
                        }, data)
                        vm.use(ElementPlus, {
                            locale: ElementPlusLocaleZhCn,
                        }).mount('#my_popup_' + m.stadiumId);
                    })

                    // 弹窗关闭时，一定需要销毁vue实例！非常重要！
                    marker.on('popupclose', e => {
                        vm.unmount();
                    })

                    rootTitle = '<div id="my_popup_' + markerId + '"></div>'
                    marker.bindPopup(rootTitle, {offset: [0, -24]});
                    markerClassName = 'my-marker';
                    if (poi.StadiumBizType == '公共体育场馆') {
                        markerClassName = 'my-marker-crimson'
                    } else if (poi.StadiumBizType == '小区') {
                        markerClassName = 'my-marker-cadetblue'
                    } else if (poi.StadiumBizType == '学校') {
                        markerClassName = 'my-marker-blue'
                    } else if (poi.StadiumBizType == '公园') {
                        markerClassName = 'my-marker-green'
                    } else if (poi.StadiumBizType == '酒店') {
                        markerClassName = 'my-marker'
                    } else if (poi.StadiumBizType == '单位') {
                        markerClassName = 'my-marker-crimson'
                    }
                    marker.bindTooltip(poi.title, {
                        permanent: true,
                        direction: 'top',
                        offset: [0, -24],
                        className: markerClassName
                    }).openTooltip();

                    this.markers.push(marker);
                    marker.addTo(toRaw(markers));

                    // markers.addLayer(marker);
                }
                markers.addTo(toRaw(map));

                return markers;
            },

            // 获取一条路线的 latlngs
            getRouteLatLngs(route) {
                var latlngs = [];

                // 循环将 route path 中 的 coordinates 添加到 latlngs 中, coordinates 的格式是 [lng, lat]
                for (var j = 0; j < route.paths.length; j++) {
                    var path = route.paths[j];
                    for (var k = 0; k < path.coordinates.length; k++) {
                        latlngs.push([path.coordinates[k][1], path.coordinates[k][0]]);
                    }
                }

                return latlngs;
            },

            // 显示所有路线
            showAllRoute(map) {
                mapInfo = this.mapInfo;
                for (var i = 0; i < mapInfo.mapRoutes.length; i++) {
                    var route = mapInfo.mapRoutes[i];
                    if (route.paths.length == 0) {
                        continue;
                    }
                    var latlngs = this.getRouteLatLngs(route);

                    var polyline = L.polyline(latlngs, {color: route.routeColor || '#964DFF', opacity: 0.8, weight: 6})
                        .addTo(map);

                    // 加上剪头
                    // polyline.setText('        >>        ', { offset: 1, repeat: true, attributes: {fill: 'white', class: 'line-arrow'}});
                    var decorator = L.polylineDecorator(polyline, {
                        patterns: [
                            {
                                offset: 25, // 起始偏移
                                repeat: 50, // 重复间隔
                                symbol: L.Symbol.arrowHead({
                                    pixelSize: 4,
                                    polygon: false,
                                    pathOptions: {stroke: true, color: '#ffffff', weight: 1}
                                })
                            }
                        ]
                    }).addTo(map);
                }
            },

            // 显示所有区域
            showAllArea(map) {
                for (var i = 0; i < mapInfo.mapAreas.length; i++) {
                    var area = mapInfo.mapAreas[i];
                    if (area.coordinates.length == 0) {
                        continue;
                    }
                    var latlngs = [];
                    for (var j = 0; j < area.coordinates.length; j++) {
                        latlngs.push([area.coordinates[j][1], area.coordinates[j][0]]);
                    }

                    var polygon = L.polygon(latlngs, {color: area.areaColor || '#964DFF', opacity: 0.8, weight: 2})
                        .addTo(map);

                    var areaName = area.title || '';

                    // Add area name as a marker at the center of the polygon
                    var centerLatLng = polygon.getBounds().getCenter();

                    console.log(centerLatLng);

                    var textLabel = L.divIcon({
                        className: 'text-label',
                        html: '<div>' + areaName + '</div>',
                        iconSize: [100, 40],
                        iconAnchor: [50, 20]
                    });

                    L.marker(centerLatLng, {icon: textLabel}).addTo(map);
                }
            },

            getQueryParams() {
                let params = {};
                let queryString = window.location.search.substring(1);
                let queries = queryString.split("&");
                for (let i = 0; i < queries.length; i++) {
                    let pair = queries[i].split("=");
                    params[pair[0]] = decodeURIComponent(pair[1]);
                }
                return params;
            },

            getDayOfWeek(dateStr) {
                // 将日期字符串转换为Date对象
                let inputDate = new Date(dateStr);
                // 获取输入日期的时间戳
                let inputTime = inputDate.getTime();
                // 获取当前日期
                let currentDate = new Date();
                // 获取当前日期的时间戳
                let currentTime = currentDate.getTime();
                // 一天的毫秒数
                let oneDayTime = 24 * 60 * 60 * 1000;
                // 一周的毫秒数
                let oneWeekTime = 7 * oneDayTime;

                // 计算输入日期与当前日期的时间差（以天为单位）
                let diffDays = Math.floor((inputTime - currentTime) / oneDayTime);
                // 计算输入日期与当前日期的周数差
                let diffWeeks = Math.floor(diffDays / 7);

                // 获取输入日期是星期几，0代表周日
                let dayOfWeek = inputDate.getDay();
                // 定义表示星期的数组
                let daysOfWeek = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];

                // 根据周数差返回相应的信息
                if (diffWeeks === 0) {
                    return `本${daysOfWeek[dayOfWeek]}`;
                } else if (diffWeeks === 1) {
                    return `下${daysOfWeek[dayOfWeek]}`;
                } else if (diffWeeks === 2) {
                    return `下下${daysOfWeek[dayOfWeek]}`;
                } else {
                    return `${daysOfWeek[dayOfWeek]}`;
                }

            },
            addComment(data) {
                this.showCommentModal = true; // 显示评论模态框
                console.log('Received data from child:', data.res); // 打印数据
            },
            closeCommentModal() {
                this.showCommentModal = false; // 关闭评论模态框
            },
            submitComment() {
                alert(`评论提交成功:\n姓名: ${this.commentAuthor}\n内容: ${this.commentText}`);
                this.closeCommentModal(); // 关闭模态框
                this.commentAuthor = ''; // 清空输入
                this.commentText = ''; // 清空输入
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            },
            handleClose: function (done) {
                this.closeForm();
                done();
            },
            closeForm() {
                this.searchDialogVisible = false;
                document.getElementById("popup").style.display = "none";
            },
            submitSearchForm(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        this.loading = true;
                        this.search();
                        this.cancelSubmit('searchForm');
                    } else {
                        return false;
                    }
                });
            },
            cancelSubmit(formName) {
                this.closeForm();
                this.resetForm(formName);
            },

            onlineSearchBtnClick: function(btn, map) {
                document.getElementById("popup").style.display = "block";
                this.searchDialogVisible = true;
            },
            search() {
                const postData = {
                    "date_start": this.formatDate(this.searchForm.date),
                    "date_end": this.formatDate(this.searchForm.date),
                    "lng": "121.5430645073785",
                    "lat": "31.32092013888889",
                    "hour_filter_start": parseInt(this.searchForm.startTime.substring(0, 2)),
                    "hour_filter_end": parseInt(this.searchForm.endTime.substring(0, 2)),
                    "filter_continues_hour": this.searchForm.continuesHour,
                    "stadium_types": this.searchForm.stadiumTypes,
                    "court_types": this.searchForm.courtTypes,
                    "stadium_keyword": this.searchForm.name,
                    "search_type": 0
                };
                console.log(postData)

                fetch('https://shawyerpeng.cn:8888/labor/api/sports8/list', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Origin': 'github.com',
                    },
                    body: JSON.stringify(postData)  // 将JavaScript对象转换为JSON字符串发送
                }).then(response => {
                    if (!response.ok) {
                        this.loading = false;
                        throw new Error('网络请求失败，状态码：' + response.status);
                    }
                    return response.json();
                }).then(data => {
                    // console.log('POST请求成功，返回的数据：', data);
                    console.log(this.map);
                    let foundGroup;
                    this.map.eachLayer((layer) => {
                        if (layer instanceof L.LayerGroup) {
                            foundGroup = layer;
                        }
                    });
                    console.log(foundGroup);
                    foundGroup.clearLayers();
                    // this.map.eachLayer((layer) => {
                    //     myGroup.clearLayers();
                    //     this.map.removeLayer(layer);
                    // });
                    var idx = 0;
                    // 先清空
                    this.mapInfo.mapPois = [];
                    for (var i = 0; i < data.data.length; i++) {
                        tmp = data.data[i]
                        if (tmp.LngLat == '0,0') {
                            continue
                        }
                        this.mapInfo.mapPois[idx++] = {
                            poi: {
                                id: tmp.StadiumId,
                                title: tmp.StadiumName,
                                Status: tmp.Status,
                                lng: parseFloat(tmp.LngLat.split(',')[0]),
                                lat: parseFloat(tmp.LngLat.split(',')[1]),
                                Address: tmp.Address,
                                ImgUrl: tmp.ImgUrl,
                                ImgUrls: tmp.ImgUrls,
                                StadiumType: tmp.StadiumType,
                                CourtType: tmp.CourtType,
                                SportsType: tmp.SportsType,
                                StadiumBizType: tmp.StadiumBizType,
                                Level: tmp.Level,
                                StadiumTel: tmp.StadiumTel,
                                ReservationPlatform: tmp.ReservationPlatform,
                                CountyName: tmp.CountyName,
                                Detail: tmp.Detail,
                                FacilityInfos: tmp.FacilityInfos,
                                MinPrice: tmp.MinPrice,
                                BookableMaxDate: tmp.BookableMaxDate,
                                ShowHour: tmp.ShowHour,
                                ShowHourDesc: tmp.ShowHourDesc,
                                CourtsNum: tmp.CourtsNum,
                            }
                        }
                    }
                    this.showMap(this.map, false);
                    // allMarkers = this.markers;
                    // var keepIds = []
                    // for (var i = 0; i < data.data.length; i++) {
                    //     tmp = data.data[i];
                    //     keepIds.push(tmp.StadiumId);
                    // }
                    // for (var i = 0; i < allMarkers.length; i++) {
                    //     marker = allMarkers[i];
                    //     if (!keepIds.includes(marker.stadiumId)) {
                    //         marker.closeTooltip(); // 显式关闭Tooltip
                    //         marker.setOpacity(0); // 隐藏标记点
                    //         // 若标记使用了阴影
                    //         if (marker.getIcon().options.shadow) {
                    //             marker.setIcon(
                    //                 L.icon({
                    //                     ...marker.getIcon().options,
                    //                     shadowUrl: 'transparent-shadow.png' // 替换为透明图片
                    //                 })
                    //             );
                    //         }
                    //     } else {
                    //         marker.openTooltip();
                    //         marker.setOpacity(1);
                    //     }
                    // }
                    this.loading = false;
                }).catch(error => {
                    console.error('POST请求出错：', error);
                    this.loading = false;
                });
            },
            formatDate(date) {
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0'); // 月份从0开始
                const day = date.getDate().toString().padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
        }
    });
    app.use(ElementPlus, {
        locale: ElementPlusLocaleZhCn,
    });
    app.mount('#app')
</script>

</body>

</html>
